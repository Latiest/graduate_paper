\chapter{绪论}
\section{研究背景和意义}
天然气是世界上广泛使用的能源。2022年的数据显示，世界天然气消费量为3.94万亿立方米，全球油气勘探开发投资支出4934亿美元，其中我国全国天然气
消费量3646亿立方米，进口天然气1503亿立方米\cite{chinaGasGOv}。其在我国的能源资源中占有举足轻重的地位。
同时，随着计算机技术的快速发展和软件技术的高速迭代，利用计算机技术应用于传统行业已经十分有必要。
尽管我国原材料工业数字化转型不断走向纵深，但仍面临计算机技术应用于产业不够深入等问题\cite{workplanForPetrochemical}。

在陕西某油田企业多年发展过程中,其气井数量及集气站规模持续扩张。但随着气井投产时间延长,老旧气井管理难度加大,间歇生产井比例也在上升。同时,企业过去积累了大量未被充分利用的数据资源。为实现气井的科学管理,亟需引入大数据和机器学习技术,以数
据驱动的方式优化气井生产决策。

该企业过去缺乏对气井的分类管理,忽视了不同类型气井的特性和生产条件差异,未能针对性地采取最优管理和维护策略,导致资源分配不均、管理效率低下。比如,成熟气井或老旧气井需要更多维护和特定生产措施以延长生产寿命或提升效率,
但一刀切的策略忽略了这些井的特殊需求,造成了一系列无效或过度投入。因此,企业需要基于现有报表数据对气井进行分类,实现差异化管理。目前，已经有相当多的学者开展了气井分类方
面的研究，但当前绝大多数的分类方法需要基于
现场管理认识，给出指定的分类界限，对管理经验要
求较高的同时，还具有相当的主观性\cite{SYZC202104015}。本文结合RFM模型\cite{birant2011data}和核密度估计\cite{chen2017tutorial}的方法，通过数据驱动的方式对气井进行分类。

此外，该企业在制定开发方案及销售计划时，主要依赖管理层经验。因此，企业需对气井产量进行预测，以便更好地理解气藏的生产潜力与开采前景，为优化开发方案提供科学依据。企业需要对气井产气量进行预测。本文在得到分类结果的基础上，提出了基于Transfor
mer的气井产量预测算法，可以实现对气井产量的较高精度预测。将该算法与基于LightGBM的气井产量预测算法对比发现，改算法预测精度较高，但实时性较差，因此将两种算法保留供企业在特定需求的情况下进行模型选择。

在处理企业后续智能分析的新需求如气井三维建模过程时，需要引入地质参数和钻井等技术数据，发现由于企业早期对数据管理重视不足，大量宝贵数据散布在不同平台，形成了数据孤岛，同时许多员工掌握了大量线下数据，在数据整合时遇到了重重困难。为了解决这一问题，
本文采用数据湖方法,以原始状态存储数据,实现任意来源、类型数据的全量获取、存储、多模式处理分析与全生命周期管理,为企业后续智能分析提供数据支撑。

综上,受企业委托,本文提出了基于机器学习的气井智能管控系统,运用现有理论完成气井分类、产量预测等工作,并根据企业需求设计了智能管控系统。
该系统不仅包括气井分类、产量预测等智能分析功能,还针对企业数据管理混乱的痛点,
设计了数据连接、数据管理等功能。目前,该系统已完成一期交付并在线上良好运行。

% 。同时，苏里格气田是典型的三低（低渗透、低压力、低丰度）气田，不仅单井产量低，产量递减快，压力下降快，且积液严重，大多数为间歇性气井\cite{KTSY202306014}。
% 对于该气田而言，不同井的特征随时间变化的差异很大，相对于基于传统特征的分类方法，采用时间序列聚类分析方法可以深入分析气井随时间变化的产气量，允许用户精准地识别出不同生产条件下气井的行为模式。时间序列聚类能够基于实际的生产动态，而不仅仅是静态和动态特征，提供更个性化、适应性更强的气井预测算法，从而可以根据预测结果来提供开关井策略。这有助于最大化生产效率，减少液体积累带来的问题，优化生产过程，从而在不同的生产阶段维持气井的最佳运行状态，提高整体的生产效能。

% 气井产能预测是气田开采过程中最基本的任务之一。常用的传统的预测气井产量的方式有两种：预测气井的绝对无阻流量和通过递减曲线分析来预测产量。气井的无阻流量指的是在气井井底流压降低到0.1MPa时，气井的产气量。实测无
% 阻流量指的是将气井彻底敞开，当井底流动压力和大气压保持相同时，测量产气量， 此即为实测无阻流量。 该方法被认为是不合理的 ， 原因在于气管尺寸会影响到结果的准确
% 性。而且操作过程中形成的气体会有严重的消耗，在水的锥进以及砂子颗粒的磨损作用下气井会受到影响。递减曲线分析方法依赖于简化假设和历史生产数据，这可能不完全反映复杂的地质和工程条件，特别是在非常规气藏中。
% 此外，该方法忽略了井筒和地层之间的非均质性，需要长期的生产历史来形成准确的分析，且未考虑经济因素，从而可能导致对未来产量的预测不够准确或适用。

% 鉴于传统预测方法有诸多弊端，很多学者采用机器学习如时间序列预测等方法来预测气井产量，目前油气产量时间序列预测的研究大多是同步时间序列预测，问题描述为：已知属性（Source）和预测目标（Target）在每一步相对应，且已知属性时间序列长度和预测目标时间序列长度相等时计算产量。同步时间序列预测实际上是对未测量数据的计算，因此，能够应用的场景有限。
% 本文通过将静态变量，现在已知的未来变量和过去的动态变量融合到同一个网络中，可以进行多时间尺度的预测。

% 在对气井进行预测后，企业可以根据预测结果来进行开关井推荐，使得生产决策更加数据驱动，确保资源的有效利用。气井的产量通常受到管网两端压力差的限制。当管网两端的压力差较大时，气井的产量会增加；而当压力差较小时，气井的产量会减少。相应地，开
% 关井操作会改变管网两端的压力差。一般情况下，开井会导致管网两端的压力差减小，而关井则会导致压力差增大。此外，当管网两端的压力差发生变化时，会对气井的稳定性产生影响。特别是在压力差较小时，气井的稳定性容易受到影响。因此，在开关井控制中，需要综合考
% 虑管网两端的压力差和气井的稳定性因素，制定最优的开关井策略，以确保气井的生产稳定性。

\section{国内外研究现状}
\subsection{时间序列预测算法}
在时间序列分析的历史进程中，自回归模型\cite{PhysRevE.84.016106}（AR），首次提出于1927年，为统计学在时间序列预测领域的应用奠定了基础。
随后，自回归积分移动平均\cite{jiang2011multifractal}（ARIMA）模型的发展，标志着基于统计学的预测方法进入了一个新阶段，ARIMA模型因其综合了自回归、积分和移动平均的特性而成为后续研究的核心。
此后的模型大多在此模型的基础上进行改进。

这些模型的建立和预测精度在很大程度上依赖于参数选择，而不当的参数设定可能导致预测效果不佳，尤其是在面对复杂和动态变化的数据时。因此，尽管统计学模型在时间序列分析领域内有着长久的应用历史和理论基础，但在实际应用中仍需要细致的参数调整和模型选择。
因此，近年来基于机器学习技术的时间序列预测方法受到了越来越多的关注和研究。

机器学习在处理时间序列数据时表现的十分优秀。支持向量机\cite{zhang2020support}是一种二分类模型，但可以通过多个支持向量机进行回归预测\cite{sapankevych2009time}。在时间序列预测中，支持向量机常用的核函数包括线性核函数、多项式核函数和径向基核函数。
随机森林\cite{genuer2020random}是一种集成学习算法，其基本单元为决策树。在时间序列预测中，随机森林可以对多个决策树进行集成，从而提高预测的准确性\cite{khashei2019comparative}。
集成学习\cite{dong2020survey}是一种将多个弱分类器组合成强分类器的机器学习算法。在时间序列预测中，集成学习可以通过组合多个基模型来提高预测的准确性\cite{galicia2019multi}。常用的集成学习算法包括Adaboost、Bagging和随机森林等。
其中LightGBM\cite{ke2017lightgbm}是一个基于Boosting的集成树模型，由微软亚洲研究院开发并开源，其通过构建梯度提升决策树来预测时间序列。该框架特别适合处理大规模数据集，因为它采用了直方图优化算法和叶子优先的树增长策略，显著降低了内存消耗和提升了计算速度。
LightGBM还支持分类特征和连续特征，使其能够灵活处理各种类型的时间序列数据。此外，通过应用自动特征选择和过拟合防止策略，LightGBM能够生成准确且鲁棒的时间序列预测模型。

此外，还有一系列神经网络算法也应用于时间序列预测领域。循环神经网络\cite{li2018independently}（RNN）是1990年由Elman首次提出，用于处理序列数据。RNN通过在模型中设置隐藏层来保存过去的状态，并将其作为后续输入的一部分，以此来捕获时序信息。
然而，RNN在处理长期依赖问题时表现不佳，因此发展出了长短期记忆网络\cite{yu2019review}（LSTM）和门控循环单元\cite{dey2017gate}（GRU）等改进型网络。LSTM通过引入控制门机制来改善长时间依赖的捕获，而GRU则简化了LSTM结构，降低了模型复杂度。
此外，为了解决RNN只能利用单向数据的限制，双向循环网络\cite{graves2005framewise}（Bi-LSTM）被提出，使模型能同时利用过去和未来的信息。自2017年由Vaswani等人提出Transformer模型\cite{vaswani2017attention}以来，其已成为深度学习领域的革命性创新。
该模型通过引入自注意力机制，有效改进了对长期依赖性的学习，显著提升了自然语言处理等领域的性能。尽管其在长序列预测上存在挑战，如二次时间复杂度，但其并行计算能力和高效的自注意力机制使其在多个领域得到广泛应用，展现出优越的性能。
此外，最新研究也表明，注意力机制在时间序列预测方面相比传统模型展现出更好的效果。如TFT\cite{lim2021temporal}（Temporal Fusion Transformers），其结合了LSTM和自注意力机制的优势，能够有效地捕获时间序列中的长期和短期依赖性。
TFT 的核心是一个多头自注意力机制，它允许模型同时关注过去、现在和未来的时间点，提高了预测的准确性和解释性。此外，TFT 通过其可变选择网络 (Variable Selection Networks) 部分，能够自动识别并选择对预测任务最相关的输入特征，这不仅提高了模型的效率，也增加了模型结果的可解释性。
\subsection{油气产量预测}
气井产能预测是气田开采过程中最基本的任务之一。常见的传统方法包括下降曲线分析\cite{arps1945analysis}和预测气井的绝对无阻流量\cite{rawlins1935back}。

气井的无阻流量指的是在气井井底流压降低到0.1MPa时，气井的实测无阻流量。实测无
阻流量指的是将气井彻底敞开，当井底流动压力和大气压保持相同时，测量产气量， 此即为实测无阻流量。 该方法被认为是不合理的 ， 原因在于气管尺寸会影响到结果的准确
性。而且操作过程中形成的气体会有严重的消耗，在水的锥进以及砂子颗粒的磨损作用下气井会受到影响。

下降曲线分析方法依赖于简化假设和历史生产数据，这不能完全反映复杂的地质和工程条件，特别是在非常规气藏的条件下。
此外，该方法忽略了井筒和地层之间的非均质性，需要长期的生产历史来形成准确的分析，且未考虑经济因素，从而可能导致对未来产量的预测不够准确或适用。

鉴于传统预测方法有诸多弊端，很多学者采用机器学习的方法来预测气井产量。

包括将下降曲线与机器学习结合的方法。如Hai Wang\cite{WANG2024123387}等人使用物理信息神经网络（Physics-Informed Neural Network, PINN）来识别页岩气井的产量下降曲线。
其通过整合Caputo分数阶导数、自动微分和稀疏回归，对Duvernay地层中20口井的生产数据进行训练。结果显示，非均匀分数阶微分方程能够准确描述产量下降曲线。韩克宁等人\cite{KTDQ202305012}将产量递减模型与机器学习方法相结合，建立了一种新的页岩气井产量
递减模型与LSTM（长短时间记忆神经网络）模型耦合预测方法。实验结果显示对于误差较大的递减模型，其预测精度显著提高。Tadjer等人\cite{10.2118/209616-PA}将自动化机器学习技术与基于贝叶斯神经常微分方程的时间序列建模框架相结合。
其利用衰减曲线分析（DCA）模型传递有关“物理学”的信息给BN-ODE框架，
并使用单个油井的完井参数（如位置、长度和滑水体积）以及石油产量数据作为输入，以提供个别油井的长期石油产量预测。

采用集成学习的方法如李菊花等人\cite{CJDL202004006}针对页岩气藏多段压裂水平井产量预测精度不高的问题，通过分析储层物性和压裂施工参数，引入随机森林算法进行预测。Wente Niu等人\cite{NIU2023127443}针对新区块页岩气井产量预测模型因训练数据不足的问题，提出了一种转移学习策略。
该策略利用改进的神经网络作为基础学习器，通过域适应找到源区块和目标区块之间的领域不变特征提取，并使用Bagging算法进行集成学习，以提高预测性能。You-Wei He等人\cite{HE20231659}使用随机森林算法来预测页岩气的产量。并基于中国页岩气库的数据，其页岩气产量水平的预测准确率高于95\%。
Liang Xue等人\cite{XUE2021107801}提出了一种多目标随机森林方法来预测动态生产数据。使用地质和水力压裂属性作为输入特征，并基于确定适当的超参数后的R平方值来评估其预测性能。其比较了多目标随机森林（MORF）和多输出回归链（MORC）方法的性能，结果表明MORC需要相对较小的随机森林结构，但MORF的预测性能优于MORC。

采用注意力机制与神经网络结合的方法如Jintao Liu\cite{LIU2023125536}针对汽油生产预测提出了一种新的使用注意力机制(AM)的门控循环单元(GRU) (AM-GRU)结合统一流形近似和投影(UMAP)的生产预测模型。
首先，使用箱线图处理工业厂的数据，以去除分位数之外的数据。然后，使用UMAP去除数据之间的强相关性，这可以提高AM-GRU的运行速度和性能。其实验结果显示该模型在稳定性和准确性上有较好效果。李媛等人\cite{KXJS202302015}为了提升煤层气产量的预测精度，提出融合注意
力(Attention)机制并结合卷积神经网络(CNN)和长短期记忆神经网络(LSTM)的煤层气产量动态预测模型。实验结果表明其煤层气产量动态预测模型各方面均表现较优。Zhenyu Yuan\cite{YUAN2021108111}等人提出了使用混合深度神经网络（HDNNs）方法来预测油藏产量，其通过整合多源和混合类型数据，如
结构测量和离散地质工程数据，提高了预测的准确性和泛化能力。

但是诸如上面这些模型，他们都没有考虑不同类型的输入变量，在进行模型构建处理数据时，将所有特征根据时间步直接连接在一起，采用一种“万物皆时序”的处理方式。这意味着不论变量是静态的还是动态的，它们都被统一扩展到每个时间步，并合并成一个整体输入到模型中。
这种方法忽略了静态和动态变量之间的本质区别。本文提出的模型采用了不同的处理策略，它区分了气井的静态和动态变量。通过这种区分，模型能够更准确地理解每种变量的性质和作用，进而在不同的情景下合理利用这些信息。
\section{论文研究内容}
根据油田企业数字化转型的问题背景分析以及相关国内外研究现状，本文基于时间序列预测领域相关的技术方案，设计了基于机器学习的气井智能管控系统。该系统包括智能管理模块和数据管理模块。本文的主要内容如下：
（1）给出了一种结合RFM模型和核密度估计的气井分类算法，用于解决气井分类的问题。首先，本文分析了对气井进行不同分类的方法，阐述了基于RFM和核密度估计方法的合理性。然后对取得的气井数据进行数据清洗，建立了气井RFM模型
的模型。最终实验结果显示，该方法可以有效地对气井进行分类。同时可以有效提高气井产气量预测的准确性。

（2）为了帮助企业有效规划气井的开发和生产过程，本文对气井进行产气量预测，给出了一种基于transformer的气井产量预测算法。首先使用滑动窗口的方法对第三章已经清洗好的数据进行数据预处理，然后根据不同的协变量
对输入的历史时刻和未来时刻的特征经过一系列变换，得到一个抽象的表征，
然后分别输入到 Encoder 和 Decoder 中。Encoder 部分使用 GRU 网络来编码历史时刻
的信息，输出一个固定长度的向量，表示整个历史序列的含义。Decoder 部分使用自
注意力机制来解码未来时刻的预测值，每个预测值都是根据之前所有时刻的加权结
果得到的。通过该算法，系统可以预测出未来时刻气井的产气量。再根据产气量预测的结果，给出推荐的气井开关井策略。

（3）设计了一个气井智能管控系统，依据该企业在数据管理上的痛点，使用Apache Hudi对煤
企业的数据进行采集和存储，使用ClickHouse提供强大的数据分析能力，搭建一个
数字化平台系统，帮助企业进行数据的存储和管理和智能分析。
\section{论文组织结构}
% 根据课题内容，论文主要组织结构如图\ref{fig:paperStructure}所示。
% \begin{figure}[H]
%     \centering
%     \caption{论文主要章节结构图}
%     \label{fig:paperStructure}
% \end{figure}
% 根据图\ref{fig:paperStructure}的主要章节结构安排，
本文主要由六个章节组成，各章节组织结构如下：

第一章：绪论。本章主要阐述了基于机器学习的气井智能管控系统的研究背景及研究意义，并对国内外当前的时间序列聚类、时间序列预测和机器学习在油气产量的应用现状进行了描述，最后简要阐述了论文的主要研究内容和论文的组织结构。

第二章：基础理论和相关技术。本章详细介绍了论文涉及的相关理论和相关技术，其中包括使用的算法技术、算法模型、数据库技术等。

第三章：结合RFM与核密度估计的气井分类算法。本章为了识别具有相似生产行为和特性的气井群体，了解不同气井的行为模式，优化生产策略，实现更有效的资源管理和分配，提出了一个结合RFM与核密度估计的气井分类算法。本章从算法流程和思路对算法模型进行介绍，对企业内部的数据
进行清洗并验证。并在最终的实验结果处显示对气井分类后再预测会得到更高的准确率。

第四章：气井产量预测算法。为了帮助相关人员更准确地理解和预测气井的生产性能，使后续的决策更加数据驱动和精准，本章提出了基于transformer的气井产量预测算法。使用企业提供的数据集，分析了应该选取的特征变量，并根据变量
与时间的关系将其分为静态变量、历史变量和已知未来变量。将这些变量输入到模型中，并采用分位数预测的方法，帮助企业获得不同分位数预测的结果，提供了更全面的未来值分布信息。为了针对企业不同的需求，本章还实现了基于LightGBM的气井产量预测算法，可以帮助企业在不同的需求下选择不同的模型。

第五章：实验结果。本章展示了气井分类和产气量预测的实验结果。结果展示分类可以提高产气量预测的准确率，同时也表明本文提出的基于Transformer的气井产量预测算法准确率高于其他算法，但是LightGBM算法的耗时更低。

第六章：系统设计与实现。本章根据油田企业数据管理和智能分析的需求，设计了一个气井智能管控系统。主要介绍了系统开发的具体实施过程和思路。首先基于系统需求进行了详细的需求分析，然后根据分析结果进行了系统的总体设计和各业务模块的设计。接着，展示了系统实现的具体结果。
本文还描述了系统测试的环境设置、进行的测试类型（包括功能性和非功能性测试）以及测试结果，最终测试结果显示其满足企业需求。

第七章：总结与展望。本章节主要进行论文所涉及工作的综合总结，对于研究中开发的气井智能管控系统，评估了其性能并指出存在的不足之处。同时，本节还反思了目前的工作，并对未来的研究方向进行展望，提出系统未来可能的优化策略和发展路径。